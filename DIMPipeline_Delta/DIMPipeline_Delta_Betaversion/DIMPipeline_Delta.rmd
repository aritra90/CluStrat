--------------------------------------------------------------------------
Background
--------------------------------------------------------------------------

The goal of the project is to explore a variety of machine learning methods
that can properly distinguish cases from controls in regards to a particular
disease/disorder given genetic data.

As we know, this was the main goal when GWAS studies were being developed.
However, the novel finding of ancestry inference from these studies was
found and explored instead.

We want to find a sophisticated 'method X' that is robust amongst different datasets with
the hope that the method would be able to work well within the same disease
domain (e.g. neurological).

Within the first couple of axes from PCA lie the geographical information that
is encoded in our genetics. This is why GWAS studies have focused on the ancestry.
However, there are axes in the PCA result that infer disease but of course they are
much more difficult to find and interpret.

--------------------------------------------------------------------------
PreReqs
--------------------------------------------------------------------------

>> module load gcc
>> module load bioinfo
>> module load plink
>> module load texlive

The '.bed' files for the particular dataset that you are using are needed.

Also, the top association SNPs from GWAS pipeline are needed (at least 2000 SNPs).

--------------------------------------------------------------------------
Command Line Arguments
--------------------------------------------------------------------------
**Running the script**
>> qsub -v dataset_prefix=/depot/pdrineas/data/DIMs/Repo/dataset_prefix,extract=yes/no,type=LDA/SVM/Ridge...,cv=kfold/loocv,help=yes/no new_GWAS_ML_script.sh

**e.g.**
>> qsub -v dataset_prefix=/depot/pdrineas/data/DIMs/Repo/PKHCGSRRS,cv=kfold,type=kSVM new_GWAS_ML_script.sh

>> qsub -v dataset_prefix=/depot/pdrineas/data/DIMs/Repo/PKHCGSRRS,cv=kfold,type="Ridge kSVM" new_GWAS_ML_script.sh

>> qsub -v dataset_prefix=/depot/pdrineas/data/DIMs/Repo/PKHCGSRRS,cv=kfold,type=all new_GWAS_ML_script.sh

Use the 'extract' option if the data has not been split into testing and training yet.
It is safe to always use the extract option but might take longer as datasets get larger.

The 'type' flag is necessary to denote what algorithm to use.

The 'cv' flag is to set what type of cross-validation to use. 5-fold is used by default.

The 'help' flag being set to 'yes' will exit the program and echo the proper usage.

Class Options = [LDA,QDA,PolyReg,Ridge,Lasso,Elastic,SVM,SVR,kSVM,RidgeSVM,RFESVM,RandomForest]

The output of a particular run (one algorithm and one type of cross-validation scheme for
many different number of top SNPs to include) will be the following:

.out file --> any print messages from running the script (PLINK command output, result statistics,
    confusion matrices, etc.)

directory --> a directory will be made to place all of the files from 'DIMdetect2.py' which are mainly
    the '.pdf' and '.tex' files.

.txt files --> many text files including the accuracies, f1 scores, parameters etc. will be generated
    for plots.

Any flag that is not specified and not mandatory (dataset_prefix) will be set to defaults and
those options will be echoed.

**Plotting**
To get comprehensive plots:

>> ./DIMspagplots.sh --data PRK/SCZ

The DIMspagplots.sh script will use the spagplots.py file to plot the information generated by the tables.
The tables are amongst the outputs as '.csv' files. They are comprehensive tables of the metric (sensitivity, specificity, etc.)
across all the algorithms run in the script.

NOTE: This script will only plot the data that is in the tables. These tables get overwritten every time the script gets run.
In order to fix this, you can just do the following (or re-run scripts specifying algorithms and getting new table):

Set the number of SNPs extracted:
>> pvals=( 100 400 800 1200 1600 2000 )

Set the list of algorithms you want to plot (each algorithm must already have results from the script):
>> typelist=( "Ridge" "LDA" "SVR" "QDA" "PolyReg" "Lasso" "Elastic" "kSVM" "RidgeSVM" "RFESVM" "RandomForest" )

Set the data prefix:
>> prefix="PRK"

Run the table generation script (this is automatically run within the script which is why its overwritten):
>> python createTable.py --pvalList "${pvals[@]}" --typeList "${typelist[@]}" --data "${prefix}"

To plot and get the full pdf, run the following:
>> python fullDoc.py --data PRK/SCZ

The 'data' flag is used to plot figures after running different algorithms for a given dataset.
For example, after running the GWAS_ML_script for Parkinsons using LDA/Ridge/SVM (3 different runs),
then running the plot file will plot accuracy and f1score lines for each of the 3 algorithms.

All of the output files will be prefixed by the dataset used, # of SNPs extracted and the datetime.
(except the '.txt' files used for plotting)

**Cleaning**
>> ./clean.sh

This script will remove most of the output files generated by the scripts just to clear clutter.

In regards to the parameters and accuracy, I am currently looping through different sets of parameters
for each value of extracted SNPs and then storing the best accuracy and parameter values. This is a bit
problematic because when comparing the performance of other algorithms whose best accuracy was gotten using
a different set of parameters, it can be inconsistent. However, currently I am only using the default set of
parameters for each algorithm.

--------------------------------------------------------------------------
Design Decisions and Issues
--------------------------------------------------------------------------

2/7/2019:
The 'Alpha' version of this code is what I define as the original or vanilla version of the entire pipeline.
From here on, many versions will be created implementing different things and altering ordering of steps,
different feature selection etc. The goal is to have these multiple versions affecting the actual commands
very little.

The 'Delta' version of the code is designed to randomly select k-SNPs from the 'assoc' file instead of the
top-k-SNPs. This can serve as a baseline performance for the original 'Alpha' version. If selecting top-k-SNPs
does not perform better than this then we have a problem.

--------------------------------------------------------------------------
End of ReadMe
--------------------------------------------------------------------------


